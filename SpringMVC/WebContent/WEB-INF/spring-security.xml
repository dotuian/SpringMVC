<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns:beans="http://www.springframework.org/schema/beans"
	xmlns:security="http://www.springframework.org/schema/security"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans 
                            http://www.springframework.org/schema/beans/spring-beans-3.2.xsd 
                            http://www.springframework.org/schema/security 
                            http://www.springframework.org/schema/security/spring-security-3.1.xsd">

	<security:http pattern="/js/**" security="none" />
	<security:http pattern="/img/**" security="none" />
	<security:http pattern="/css/**" security="none" />

	<security:http auto-config="true" use-expressions="true">
	    <!-- 对登录页面，所有的用户都可以访问 -->
        <security:intercept-url pattern="/user/login.do" access="permitAll" /> 
<!--         <security:intercept-url pattern="/logout.jsp" access="permitAll" />  -->

		<security:intercept-url pattern="/user/*" access="isAuthenticated()" />
        
        <!-- 配置登录页面为/login.jsp ，登录成功默认跳转到/user/index.do -->
		<security:form-login login-page="/user/login.do" authentication-failure-url="/user/login.do?error=true" default-target-url="/user/index.do"/>
		
        <security:logout logout-success-url="/" delete-cookies="JSESSIONID"/>
<!-- 		<security:remember-me /> -->
		
		
<!--         <security:session-management invalid-session-url="/timeout.jsp"> -->
<!--             <security:concurrency-control max-sessions="1" error-if-maximum-exceeded="true" /> -->
<!--         </security:session-management> -->

        <security:remember-me token-repository-ref="tokenRepo"/>

	</security:http>

    <beans:bean id="tokenRepo"
            class="org.springframework.security.web.authentication.rememberme.InMemoryTokenRepositoryImpl" />


    <beans:bean id="rememberMeServices"
                class="org.springframework.security.web.authentication.rememberme.PersistentTokenBasedRememberMeServices">
        <beans:property name="key" value="ZhongGang"/>
        <beans:property name="parameter" value="rememberMe"/>
        <beans:property name="cookieName" value="rememberMe"/>
        <beans:property name="userDetailsService" ref="userService"/>
        <beans:property name="tokenRepository" ref="tokenRepository"/>
    </beans:bean>

    <beans:bean id="tokenRepository"
                class="org.springframework.security.web.authentication.rememberme.JdbcTokenRepositoryImpl">
        <beans:property name="createTableOnStartup" value="true"/>
        <beans:property name="dataSource" ref="dataSource"/>
    </beans:bean>








	<!-- 配置一个认证管理器 -->
    <security:authentication-manager alias="authenticationManager">
		<security:authentication-provider user-service-ref="loginServiceImpl">  
            <!-- 数据库密码采用MD5加密保存 -->
		   <security:password-encoder hash="md5" />
		</security:authentication-provider>
	</security:authentication-manager>


	<beans:bean id="loginServiceImpl" class="com.dotuian.service.impl.LoginServiceImpl">
		<beans:property name="userDao" ref="userDao" />
	</beans:bean>
	<beans:bean id="userDao" class="com.dotuian.dao.impl.UserDaoImpl" />
    
    
    

    
</beans:beans>

	
	